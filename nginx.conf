server {
    listen 80;
    server_name localhost; # 운영 환경에서는 실제 도메인으로 변경할 수 있습니다.

    root /usr/share/nginx/html;
    index index.html index.htm;

    location / {
        # 요청된 파일이나 디렉토리가 없으면 index.html을 반환하여 React Router가 처리하도록 합니다.
        try_files $uri $uri/ /index.html;
    }

    # 필요한 경우 다른 location 블록 추가 (예: API 프록시 등)
    # /kakao/ 경로로 오는 요청을 카카오페이 API 서버로 프록시
    location /kakao/ {
        proxy_pass https://open-api.kakaopay.com/;

        # ---- SSL 핸드셰이크 실패 해결을 위한 핵심 설정 시작 ----
        proxy_ssl_server_name on;
        # $proxy_host는 proxy_pass에 지정된 호스트명(open-api.kakaopay.com)을 사용합니다.
        # 또는 직접 proxy_ssl_name open-api.kakaopay.com; 로 명시할 수도 있습니다.
        proxy_ssl_name $proxy_host;
        # ---- SSL 핸드셰이크 실패 해결을 위한 핵심 설정 끝 ----

        # 기존 헤더 설정 유지
        proxy_set_header Host open-api.kakaopay.com;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # (선택 사항) DNS 해석 문제 시 임시 해결책
        # resolver 8.8.8.8; # 주석 처리 해제하고 테스트해 볼 수 있음
    }
}